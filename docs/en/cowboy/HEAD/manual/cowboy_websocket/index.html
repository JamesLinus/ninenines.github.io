<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Nine Nines Support: Cowboy Function Reference</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Change them or set them up as you like -->
    <meta name="description" content="">
    <meta name="author" content="(Soft10) Pol Cámara">

    <!-- Stylesheets -->    
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic' rel='stylesheet' type='text/css'>
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/99s.css" rel="stylesheet">
<!--    <link href="js/google-code-prettify/prettify.css" rel="stylesheet"> -->
    <link href="/css/sh99s.css"  rel="stylesheet"/>

    <!-- Enables html5 support on older browsers, other js is placed at the end of the page to speed up loading -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link rel="shortcut icon" href="/img/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="/img/ico/apple-touch-icon-114.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="/img/ico/apple-touch-icon-72.png">
    <link rel="apple-touch-icon-precomposed" href="/img/ico/apple-touch-icon-57.png">
	<link rel="alternate" href="/feeds/atom.xml" type="application/atom+xml" title="Nine Nines Atom Feed">
  </head>

  <body class="big_text docs">
    <header id="page-head">
      <div id="topbar" class="container">
          <div class="row">
            <div class="span2">
              <h1 id="logo"><a href="/" title="99s">99s</a></h1>
            </div>
            <div class="span10">
              <!-- Top navigation and social icons-->
              <div id="side-header">
                <nav>
                  <ul>
					<li><a title="Erlang training" href="/training">Training</a></li>
                    <li><a title="Technical publications" href="/articles">Articles</a></li>
					<li><a title="Our talks" href="/talks">Talks</a></li>
					<li class="active"><a title="Our services" href="/support">Pricing &amp; Sponsoring</a></li>
					<li><a title="Community support" href="http://lists.ninenines.eu">Mailing Lists</a></li>
                    <li><a title="Contact us" href="mailto:contact@ninenines.eu">Contact</a></li>
                  </ul>
                </nav> 
                <ul id="social">
                  <li>
                    <a href="https://github.com/ninenines" title="Check our Github repositories"><img src="/img/ico_github.png" data-hover="/img/ico_github_alt.png" alt="Github"></a>
                  </li>
                  <li class="dropdown" id="twitter-links">
                    <a href="#twitter-links" class="dropdown-toggle" data-toggle="dropdown"  title="Follow us on Twitter">
                        <img src="/img/ico_twitter.png" data-hover="/img/ico_twitter_alt.png" alt="Twitter">
                    </a>                 
                    <ul class="dropdown-menu">
                      <li><a title="Visit Loïc Hoguin's Twitter Account" href="http://twitter.com/lhoguin">@lhoguin</a></li>
                      <!-- <li class="divider"></li>
                      <li><a title="Visit our official Twitter account" href="#">@99s</a></li> -->
                    </ul>
                  </li>
                  <!-- <li>
                    <a href="/css/" title="Add us on Linkedin"><img src="/img/ico_linkedin.png" data-hover="img/ico_linkedin_alt.png" alt="Linkedin"></a>
                  </li> -->
                </ul>
              </div>
            </div>
          </div>
      </div>


    </header>


<div id="contents" class="two_col">
<div class="container">
<div class="row">
<div id="docs" class="span9 maincol">

<h1 class="lined-header"><span>cowboy_websocket</span></h1>

<p>The <code>cowboy_websocket</code> module implements the Websocket protocol.</p>

<p>This module is a sub protocol that defines four callbacks to be implemented by handlers. The <code>init/2</code> and <code>terminate/3</code> callbacks are common to all handler types and are documented in the manual for the <a href="/docs/en/cowboy/HEAD/manual/cowboy_handler">cowboy_handler</a> module.</p>

<p>The <code>websocket_handle/3</code> and <code>websocket_info/3</code> callbacks are specific to Websocket handlers and will be called as many times as necessary until the Websocket connection is closed.</p>

<p>The <code>init/2</code> callback can be used to negotiate Websocket protocol extensions with the client. It is highly recommended to return a timeout value from this callback to ensure that the process is terminated when no data has been received during that timespan. The default timeout is <code>infinity</code>, which should only be used if you have alternate means of ending inactive connections.</p>

<p>Cowboy will terminate the process right after closing the Websocket connection. This means that there is no real need to perform any cleanup in the optional <code>terminate/3</code> callback.</p>

<h2 id="meta_values">Meta values</h2>

<h3 id="websocket_compress">websocket_compress</h3>

<p>Type: true | false</p>

<p>Whether a websocket compression extension in in use.</p>

<h3 id="websocket_version">websocket_version</h3>

<p>Type: 7 | 8 | 13</p>

<p>The version of the Websocket protocol being used.</p>

<h2 id="terminate_reasons">Terminate reasons</h2>

<p>The following values may be received as the terminate reason in the optional <code>terminate/3</code> callback.</p>

<h3 id="normal">normal</h3>

<p>The connection was closed normally before establishing a Websocket connection. This typically happens if an <code>ok</code> tuple is returned from the <code>init/2</code> callback.</p>

<h3 id="remote">remote</h3>

<p>The remote endpoint closed the connection without giving any further details.</p>

<h3 id="{remote, code, payload}">{remote, Code, Payload}</h3>

<p>The remote endpoint closed the connection with the given <code>Code</code> and <code>Payload</code> as the reason.</p>

<h3 id="stop">stop</h3>

<p>The handler requested to close the connection, either by returning a <code>stop</code> tuple or by sending a <code>close</code> frame.</p>

<h3 id="timeout">timeout</h3>

<p>The connection has been closed due to inactivity. The timeout value can be configured from <code>init/2</code>.</p>

<h3 id="{crash, class, reason}">{crash, Class, Reason}</h3>

<p>A crash occurred in the handler. <code>Class</code> and <code>Reason</code> can be used to obtain more information about the crash. The function <code>erlang:get_stacktrace/0</code> can also be called to obtain the stacktrace of the process when the crash occurred.</p>

<h3 id="{error, badencoding}">{error, badencoding}</h3>

<p>A text frame was sent by the client with invalid encoding. All text frames must be valid UTF-8.</p>

<h3 id="{error, badframe}">{error, badframe}</h3>

<p>A protocol error has been detected.</p>

<h3 id="{error, closed}">{error, closed}</h3>

<p>The socket has been closed brutally without a close frame being received first.</p>

<h3 id="{error, reason}">{error, Reason}</h3>

<p>A socket error ocurred.</p>

<h2 id="callbacks">Callbacks</h2>

<h3 id="websocket_handle">websocket_handle(InFrame, Req, State) -> {ok, Req, State} | {ok, Req, State, hibernate} | {reply, OutFrame | [OutFrame], Req, State} | {reply, OutFrame | [OutFrame], Req, State, hibernate} | {stop, Req, State}</h3>

<p>Types:</p>

<ul>
<li>InFrame = {text | binary | ping | pong, binary()}</li>
<li>Req = cowboy_req:req()</li>
<li>State = any()</li>
<li>OutFrame = cow_ws:frame()</li>
</ul>

<p>Handle the data received from the Websocket connection.</p>

<p>This function will be called every time data is received from the Websocket connection.</p>

<p>The <code>stop</code> return value can be used to close the connection. A close reply will also result in the connection being closed.</p>

<p>The <code>hibernate</code> option will hibernate the process until it receives new data from the Websocket connection or an Erlang message.</p>

<h3 id="websocket_info">websocket_info(Info, Req, State) -> {ok, Req, State} | {ok, Req, State, hibernate} | {reply, OutFrame | [OutFrame], Req, State} | {reply, OutFrame | [OutFrame], Req, State, hibernate} | {stop, Req, State}</h3>

<p>Types:</p>

<ul>
<li>Info = any()</li>
<li>Req = cowboy_req:req()</li>
<li>State = any()</li>
<li>OutFrame = cow_ws:frame()</li>
</ul>

<p>Handle the Erlang message received.</p>

<p>This function will be called every time an Erlang message has been received. The message can be any Erlang term.</p>

<p>The <code>stop</code> return value can be used to close the connection. A close reply will also result in the connection being closed.</p>

<p>The <code>hibernate</code> option will hibernate the process until it receives another message or new data from the Websocket connection.</p>


<!-- a.code -->
</div>

<div class="span3 sidecol">
<div class="input-append">
<form id="form-search" class="form-search" action="#">
	<input id="input-search" type="text" placeholder="Function search" autocomplete="off" autofocus class="input-medium search-query span2">
	<button type="submit" class="btn btn-success">Go</button>
</form>
</div>

<h3 id="docs-nav">Navigation</h3>

<h3>See also</h3><ul><li><a href="/docs/en/cowboy/HEAD/guide/">User Guide</a></li><li><a href="/docs/en/cowboy/HEAD/index.html">README</a></li></ul>

<h3>Version select</h3>
<ul>

	<li><a href="/docs/en/cowboy/1.0/manual/"><strong>1.0</strong></a></li>

	<li><a href="/docs/en/cowboy/HEAD/manual/"><strong>HEAD</strong></a></li>

</ul>

</div>
</div>
</div>
</div>


      <footer>
        <div class="container">
          <div class="row">
            <div class="span6">
              <p id="scroll-top"><a href="#">↑ Scroll to top</a></p>
              <nav>
                <ul>
                  <li><a href="mailto:contact@ninenines.eu" title="Contact us">Contact us</a></li><li><a href="https://github.com/ninenines/ninenines.github.io" title="Github repository">Contribute to this site</a></li>
                </ul>
              </nav>
            </div>
            <div class="span6 credits">
               <p><img src="/img/footer_logo.png"></p>
               <p>Copyright &copy; Nine Nines 2012-2014</p>
            </div>
          </div>
        </div>
      </footer>

    <!-- Javascript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/js/bootstrap-carousel.js"></script>
    <script src="/js/bootstrap-dropdown.js"></script>
    <script src="/js/custom.js"></script>


<script type="text/javascript" src="/js/shCore.js"></script>
<script type="text/javascript" src="/js/shlang/shBrushBash.js"></script>
<script type="text/javascript" src="/js/shlang/shBrushErlang.js"></script>
<script type="text/javascript" src="/js/shlang/shBrushJScript.js"></script>
<script type="text/javascript" src="/js/shlang/shBrushPlain.js"></script>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<script type="text/javascript" src="/js/fuse.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
	var f;

	$.getJSON("/docs/db.json", function(data){
		f = new Fuse(data, {keys: ["n"], threshold: 0.3});
		$("<ul id=\"search-results\">").insertAfter("#form-search");
	});

	$("#input-search").keyup(function(e){if(f){if (e.which != 13 ){
		var results = f.search($(this).val());
		if (results.length == 0){
			$("#form-search").attr("action", "#");
		}else{
			$("#form-search").attr("action", results[0].l);
		}

		$("#search-results").empty();
		for (var i = 0; i < 10 && i < results.length; i++){
			$("<li><a href=\"" + results[i].l + "\">" + results[i].n + "</a></li>")
				.appendTo("#search-results");
		}
	}}});
});
</script>

<script type="text/javascript">var switchTo5x=true;</script>
<script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
<script type="text/javascript">stLight.options({publisher: "86681c5a-011b-481b-98b8-22b548283fe5", doNotHash: true, doNotCopy: true, hashAddressBar: false});</script>

  </body>
</html>
