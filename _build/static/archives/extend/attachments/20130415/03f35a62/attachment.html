<tt>
&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Hello&nbsp;group,&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;I&nbsp;am&nbsp;trying&nbsp;to&nbsp;put&nbsp;together&nbsp;a&nbsp;CSRF&nbsp;middleware &lt;a&nbsp;href=&quot;https://github.com/rambocoder/stable/commit/b26980d292ac42aadfe9921a961436e28cdbb693&quot;&gt;https://github.com/rambocoder/stable/commit/b26980d292ac42aadfe9921a961436e28cdbb693&lt;/a&gt; and&nbsp;if&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;contains&nbsp;&quot;_csrf&quot;&nbsp;token,&nbsp;I&nbsp;check&nbsp;to&nbsp;make&nbsp;sure&nbsp;it&nbsp;matches&nbsp;the&nbsp;csrf&nbsp;token&nbsp;in&nbsp;the&nbsp;session.&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Currently&nbsp;I&nbsp;am&nbsp;doing&nbsp;it&nbsp;in&nbsp;middleware&nbsp;using&nbsp;cowboy_req:body_qs/1&nbsp;however&nbsp;when&nbsp;in&nbsp;the&nbsp;handler&nbsp;I&nbsp;need&nbsp;to&nbsp;read&nbsp;another&nbsp;body&nbsp;parameter,&nbsp;such&nbsp;as&nbsp;in&nbsp;the&nbsp;rest_pastebin&nbsp;example:&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;{ok,&nbsp;BodyQs,&nbsp;Req3}&nbsp;=&nbsp;cowboy_req:body_qs(Req),&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/span&gt;Paste&nbsp;=&nbsp;proplists:get_value(&lt;&lt;&quot;paste&quot;&gt;&gt;,&nbsp;BodyQs),&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;cowboy_req:body_qs/1&nbsp;returns&nbsp;[]&nbsp;due&nbsp;to&nbsp;the&nbsp;body&nbsp;of&nbsp;the&nbsp;request&nbsp;being&nbsp;already&nbsp;read {body_state,done}&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Is&nbsp;it&nbsp;pointless&nbsp;to&nbsp;have&nbsp;the&nbsp;type&nbsp;of&nbsp;CSRF&nbsp;middleware&nbsp;that&nbsp;I&nbsp;am&nbsp;writing&nbsp;and&nbsp;just&nbsp;do&nbsp;the&nbsp;CSRF&nbsp;in&nbsp;the&nbsp;handler&#39;s&nbsp;callback,&nbsp;where&nbsp;I&nbsp;can&nbsp;deal&nbsp;with&nbsp;all&nbsp;the&nbsp;body_qs&nbsp;at&nbsp;once?&lt;/div&gt;<br>
&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;Thank&nbsp;you,&lt;/div&gt;&lt;div&nbsp;style&gt;&lt;br&gt;&lt;/div&gt;&lt;div&nbsp;style&gt;rambocoder&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;<br>

</tt>
